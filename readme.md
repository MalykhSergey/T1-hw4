# Домашнее задание №4 IT-лагеря Т1

**Цель:** Создать token-based сервис авторизации.

**Требования:**
1) В системе существует 3 роли: admin, premium_user и guest.
2) Информация о пользователе должна включать в себя: идентификатор, логин (должен быть уникальным), пароль (должен хранится в зашифрованном виде), адрес электронной почты (должен быть уникальным), набор ролей.
3) Время жизни токена должно быть ограничено.
4) Повторное получение токена не должно требовать повторного ввода логина и пароля.
5) Сервис должен предоставлять функционал отзыва токена.

## Запуск

### Локально

```sh
mvn test
docker compose up -d postgres
mvn spring-boot:run
```

### Полностью в контейнерах Docker
```sh
docker compose up -d
```

## Описание реализации

Для реализации приложения за основу взят spring-boot-starter-web и spring-boot-starter-security.

Для реализации token-based подхода Spring security конфигурируется специальным образом: в цепочку обработчиков запроса встраивается свой фильтр - *AuthTokenFilter*. Он выполняет извлечение, валидацию, парсинг токена из запроса, а также добавляет авторизованного пользователя в контекст запроса.

В приложении для проверки прав доступа используется access-token - JWT, содержащий публичную информацию о пользователе и подписанный секретным ключом.

Для его периодического обновления используется т.н. Opaque refresh-token - строка, генерирумая сервером и сохраняемая в БД. При истечении срока *"годности"* refresh-token, клиент в пару с новеньким access-token, получит в комплекте и новый refresh-token, но только если токен существует, и не был ранее отозван.

В приложении за регистрацию, вход и выход пользователя, перевыпуск токенов отвечает пара *AuthController* и *AuthService*.

В качестве дополнения к требованиям, реализованы:
* Базовая валидация при регистрации.
* Унифицированный обработчик ошибок.
* Swagger-ui для визуальной демонстрации сервиса.
* Системные тесты, проверяющие выполнение требований.
* *UserController* для демонстрации ролевой модели доступа.

## Дополнительно

Ui доступен по ссылке: http://localhost:8080/swagger-ui/index.html

Там же можно выполнить авторизацию:
1) Регистрируем пользователя /register.
2) Авторизуемся /login.
3) Копируем access-token в форму авторизации (в правом верхнем углу).